<!DOCTYPE html>
<html>
<head>
	<title>Your favourite Videoclub is here!</title>
	<script type="text/javascript" src="requestAPI.js"></script>
	<script type="text/javascript">
		let dataRaw;
		window.onload = async function(){
			const res = await getMethod();
			dataRaw = res;
			classifyInfo(res);
		}

		const classifyInfo = function(data){
			let content='';
			if(data['peliculas']&&data['clasificaciones']){
				const movies=data['peliculas'];
				const classes=data['clasificaciones'];
				for(let i=0;i<classes.length;i++){
					const clasMovies = searchInfo(movies, classes[i].nombre);
					content+=`<li>${classes[i].nombre} <ul>`;
					for(let j=0;j<clasMovies.length;j++){
						content+=`<li>${clasMovies[j].nombre}</li>`;
					}
					content+='</ul></li>';
				}
			}
			document.getElementById('movieList').innerHTML=content;
		}

		const searchInfo = function(data, term){
			const returnElement = data.filter(el=>el['clasificacion']==term);
			return returnElement;
		}

		const addCategory = function(name){
			const oldCategories = getCategories();
			const newCategories=oldCategories;
			newCategories.push({'nombre':name, 'id':oldCategories.length});
			const newList = dataRaw;
			newList['clasificaciones']=newCategories;
			classifyInfo(newList);
			putMethod('clasificaciones', newCategories[newCategories.length-1], newCategories.length);
			dataRaw=newList;
		}

		const getCategories = function(){

			return dataRaw['clasificaciones'];
		}

		const getCategoryId = function(name){
			const categories = getCategories();
			let id=-1;
			categories.forEach(cat=> {
				if(cat.nombre==name){
					id=cat.id;
				}
			});
			return id;
		}

		const deleteCategory = function(name){
			const categories = getCategories();
			const dCat = getCategoryId(name);
			if(dCat!=-1){
				categories.splice(categories.findIndex(cat=>cat.id===dCat));
				deleteMethod('clasificaciones', dCat);
				dataRaw['clasificaciones']=categories;
				classifyInfo(dataRaw);
			}
			else{
				console.error('Category does not exist');
			}
		}

	</script>
</head>
<body>
	<header>
			<h1>WeinmanClub</h1>
			<h2>Movies. Movies Everywhere</h2>
		<nav></nav>
	</header>
	<main>
		<section>
			<article>
				<p>Párrafo sobre lo guays que somos. Añadir un subtítulo h3
				</p>
			</article>
		</section>
		<section>
			<ul id="movieList">
				<li>Lista de pelis traídas desde mock server</li>
			</ul>
		</section>
	</main>
	<footer>
		Done by Weinman. No copyright, no copyleft. Pure copycenter.
	</footer>
</body>
</html>